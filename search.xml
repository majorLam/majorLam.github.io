<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hello World</title>
      <link href="/2023/08/09/hello-world/"/>
      <url>/2023/08/09/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start">#</a> Quick Start</h2><p><img src="hello-world.assets/image-20230809205155630.png" alt="image-20230809205155630"></p><h3 id="create-a-new-post"><a class="markdownIt-Anchor" href="#create-a-new-post">#</a> Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server"><a class="markdownIt-Anchor" href="#run-server">#</a> Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files"><a class="markdownIt-Anchor" href="#generate-static-files">#</a> Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites"><a class="markdownIt-Anchor" href="#deploy-to-remote-sites">#</a> Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>这一篇测试文章</title>
      <link href="/2023/08/08/%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/"/>
      <url>/2023/08/08/%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>555</p></blockquote><h1 id="select-eemployee_id-edepartment_id"><a class="markdownIt-Anchor" href="#select-eemployee_id-edepartment_id">#</a> SELECT E.EMPLOYEE_ID, E.DEPARTMENT_ID</h1><p><font color=orange>FROM  EMPLOYEES E, DEPARTMENTS D</font><br>WHERE E.“DEPARTMENT_ID”=D.“DEPARTMENT_ID”;</p><hr><p>desc EMPLOYEES；<br>SELECT * FROM EMPLOYEES;<br>SELECT * FROM DEPARTMENTS;<br>SELECT *FROM EMPLOYEES;</p><p>– SQL92 右外连接 ------------------------------------<br>SELECT EMPLOYEE_ID, DEPARTMENT_NAME<br>FROM  EMPLOYEES E, DEPARTMENTS D<br>WHERE E.“DEPARTMENT_ID”(+)=D.“DEPARTMENT_ID”;</p><p>– --SQL99 左外连接 ------------------------------------<br>SELECT EMPLOYEE_ID,DEPARTMENT_NAME<br>from EMPLOYEES e  left outer  join DEPARTMENTS d<br>on e.DEPARTMENT_ID=d.DEPARTMENT_ID;</p><h1 id="plsql"><a class="markdownIt-Anchor" href="#plsql">#</a> PL/SQL</h1><p>procedural language SQL过程化 SQL</p><h1 id="函数"><a class="markdownIt-Anchor" href="#函数">#</a> 函数</h1><h2 id="decode函数"><a class="markdownIt-Anchor" href="#decode函数">#</a> decode 函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">decode (条件，</span><br><span class="line">        值<span class="number">1</span>，返回值<span class="number">1</span>，</span><br><span class="line">        值<span class="number">2</span>，返回值<span class="number">2</span>，</span><br><span class="line">       ......</span><br><span class="line">       值n,返回值n，</span><br><span class="line">       缺省值);</span><br><span class="line"></span><br><span class="line">该函数的含义如下：</span><br><span class="line">IF 条件<span class="operator">=</span>值<span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">　　　　<span class="keyword">RETURN</span>(翻译值<span class="number">1</span>)</span><br><span class="line">ELSIF 条件<span class="operator">=</span>值<span class="number">2</span> <span class="keyword">THEN</span></span><br><span class="line">　　　　<span class="keyword">RETURN</span>(翻译值<span class="number">2</span>)</span><br><span class="line">　　　　......</span><br><span class="line">ELSIF 条件<span class="operator">=</span>值n <span class="keyword">THEN</span></span><br><span class="line">　　　　<span class="keyword">RETURN</span>(翻译值n)</span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">　　　　<span class="keyword">RETURN</span>(缺省值)</span><br><span class="line"><span class="keyword">END</span> IF</span><br></pre></td></tr></table></figure><p>decode (条件，值 1, 返回值 1, 值 2, 返回值 2,… 值 n, 返回值 n, 缺省值)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> decode(<span class="number">100</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="comment">--100不等于1，2，3，结果返回3</span></span><br></pre></td></tr></table></figure><blockquote><p>decode (字段或字段的运算，值 1，值 2，值 3）<br>这个函数运行的结果是，当字段或字段的运算的值等于值 1 时，该函数返回值 2，否则返回值 3<br> 当然值 1，值 2，值 3 也可以是表达式，这个函数使得某些 sql 语句简单了许多</p></blockquote><p>使用方法：<br>1、<strong>比较大小</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> decode(sign(变量<span class="number">1</span><span class="operator">-</span>变量<span class="number">2</span>),<span class="number">-1</span>,变量<span class="number">1</span>,变量<span class="number">2</span>) <span class="keyword">from</span> dual;<span class="comment">--取最小值</span></span><br><span class="line"><span class="keyword">select</span> decode (sign(<span class="number">10</span><span class="number">-20</span>),<span class="number">-1</span>,<span class="number">10</span>,<span class="number">20</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><blockquote><p>sign () 函数根据某个值是 0、正数还是负数，分别返回 0、1、-1<br> 例如：<br>变量 1=10，变量 2=20<br> 则 sign (变量 1 - 变量 2) 返回 - 1，decode 解码结果为 “变量 1”，达到了取较小值的目的。</p></blockquote><p>2、此函数用在 SQL 语句中，功能介绍如下：<br>Decode 函数与一系列嵌套的 IF-THEN-ELSE 语句相似。base_exp 与 compare1,compare2 等等依次进行比较。如果 base_exp 和 第 i 个 compare 项匹配，就返回第 i 个对应的 value 。如果 base_exp 与任何的 compare 值都不匹配，则返回 default。每个 compare 值顺次求值，如果发现一个匹配，则剩下的 compare 值（如果还有的话）就都不再求值。一个为 NULL 的 base_exp 被认为和 NULL compare 值等价。如果需要的话，每一个 compare 值都被转换成和第一个 compare 值相同的数据类型，这个数据类型也是返回值的类型。</p><p>Decode 函数在实际开发中非常的有用</p><p>结合 Lpad 函数，如何使主键的值自动加 1 并在前面补 0<br>select LPAD (decode (count (记录编号),0,1,max (to_number (记录编号)+1)),14,‘0’) 记录编号 from tetdmis</p><p>eg:<br>select decode(dir,1,0,1) from a1_interval<br>dir 的值是 1 变为 0，是 0 则变为 1</p><p>比如我要查询某班男生和女生的数量分别是多少？<br> 通常我们这么写:<br>select count(<em>) from 表 where 性别 ＝ 男；<br>select count(</em>) from 表 where 性别 ＝ 女；<br>要想显示到一起还要 union 一下，太麻烦了<br>用 decode 呢，只需要一句话<br> select decode (性别，男，1，0），decode (性别，女，1，0） from 表</p><p>3，order by 对字符列进行特定的排序<br>大家还可以在 Order by 中使用 Decode。<br>例：表 table_subject，有 subject_name 列。要求按照：语、数、外的顺序进行排序。这时，就可以非常轻松的使用 Decode 完成要求了。<br>select * from table_subject order by decode (subject_name, ‘语文’, 1, ‘数学’, 2, , ‘外语’,3)</p><h1 id="ramn"><a class="markdownIt-Anchor" href="#ramn">#</a> ramn</h1><p>cmd 进入 &quot;rman target/&quot;</p><p>归档模式</p><p>archive log list;</p><p>热备份：数据库依旧在运行</p><h1 id="指令"><a class="markdownIt-Anchor" href="#指令">#</a> 指令</h1><p>1. 创建相同的表与数据（复制表）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="number">1</span> <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span><span class="keyword">from</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><h1 id="案例"><a class="markdownIt-Anchor" href="#案例">#</a> 案例</h1><h2 id="1模拟数据库非正常宕机实例故障"><a class="markdownIt-Anchor" href="#1模拟数据库非正常宕机实例故障">#</a> 1. 模拟数据库非正常宕机，实例故障</h2><p>1 执行<font color=orange>shutdown abort</font>指令前</p><p>2  查看 alert_$SID.log</p><p>会找到 crash recovery  字样，如下所示</p><p>Beginning crash recovery of 1 threads</p><p>parallel recovery started with 3 processes</p><p>Started redo scan</p><p>Completed redo scan</p><p>read 140 KB redo, 53 data blocks need recovery</p><p>Started redo application at</p><p>Thread 1: logseq 15, block 5469</p><p>Recovery of Online Redo Log: Thread 1 Group 3 Seq 15 Reading mem 0</p><p>Mem# 0: D:\APP\ORADATA\ORCL9\REDO03.LOG</p><p>Completed redo application of 0.09MB</p><p>Completed crash recovery at</p><p>在数据库当前版本，abort 选项来停止实例， 实例的 smon 后台进程会自己进行修复。</p><h2 id="2归档模式archive与非归档模式noarchive的转换"><a class="markdownIt-Anchor" href="#2归档模式archive与非归档模式noarchive的转换">#</a> 2. 归档模式（archive）与非归档模式（noarchive）的转换</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shutdown immediate</span><br><span class="line">startup mount</span><br><span class="line"><span class="keyword">alter</span> database archivelog;</span><br><span class="line">archive log <span class="keyword">start</span>;</span><br><span class="line"><span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br><span class="line">archive log list;</span><br></pre></td></tr></table></figure><h2 id="3归档模式下在线联机备份表空间-数据丢失后恢复表空间"><a class="markdownIt-Anchor" href="#3归档模式下在线联机备份表空间-数据丢失后恢复表空间">#</a> 3. 归档模式下，在线联机备份表空间， 数据丢失后恢复表空间</h2><p>①首先保证为存档模式</p><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/image-20230223220638349.png" alt="image-20230223220638349"></p><p>②</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span><span class="operator">&gt;</span><span class="keyword">alter</span> <span class="keyword">table</span>space users <span class="keyword">begin</span> backup;</span><br></pre></td></tr></table></figure><p>③将【user1.dbf】文件备份到其他的盘；</p><p>④</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span><span class="operator">&gt;</span><span class="keyword">alter</span> <span class="keyword">table</span>space users <span class="keyword">end</span> backup;</span><br></pre></td></tr></table></figure><p>⑤执行一些 DML 操作 使用表空间 users</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> me(id number);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> me <span class="keyword">values</span>(<span class="number">2023</span>);</span><br></pre></td></tr></table></figure><p>⑥ 删除 users.dbf  模拟数据丢失，介质故障</p><blockquote><p>如果提示文件被占用， 则执行 shutdown  immediate  命令</p><p>Linux 环境下可以直接 rm 命令删除</p></blockquote><p>⑦尝试启动数据库， 会遇到错误提示</p><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/image-20230223222045926.png" alt="image-20230223222045926"></p><p>⑧执行 还原操作：  将步骤 2 备份文件手工拷贝回源目录；</p><p>* 因为表空间和数据文件存在 1-n 对应关系，数据文件序号可以从数据字典 v$datafile 查询 file#</p><p>⑨执行 恢复操作：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SQL</span> <span class="operator">&gt;</span> recover  datafile  <span class="operator">&lt;</span>file#<span class="operator">&gt;</span>;</span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br></pre></td></tr></table></figure><h2 id="4-用rman-执行不完全恢复"><a class="markdownIt-Anchor" href="#4-用rman-执行不完全恢复">#</a> 4. 用 RMAN 执行不完全恢复</h2><p>1  理解不完全恢复：  就是恢复到指定的时间点， 可以是 SCN ，可以是 timestamp</p><p>2  用 RMAN 执行一次全备份  backup database plus archivelog;</p><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/wps1.jpg" alt="img"></p><p>3  新建一个表 bkp 使用 users 表空间</p><p>4  在表 bkp 中插入数据， 并且提交</p><p>5  select curent_scn from v$database;  — 生产环境中很可能无法时时刻刻记录 scn</p><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/wps2.jpg" alt="img"></p><p>6  truncate 表 bkp</p><p>7  建立一个新表 test 同样使用 users 表空间</p><p>8  在表 test 中插入数据， 提交.</p><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/wps3.jpg" alt="img"></p><p>9  记录 archive log list 的 日志序号  — 理解 resetlogs 是什么意思</p><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/wps4.jpg" alt="img"></p><p>10  此时执行 RMAN 不完全恢复脚本  ，其中 SCN  — 步骤 5 获得</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">run&#123;</span><br><span class="line">shutdown immediate</span><br><span class="line">startup mount</span><br><span class="line"><span class="keyword">set</span> until scn <span class="number">1456308</span>; </span><br><span class="line">restore database;</span><br><span class="line">recover database;</span><br><span class="line"><span class="keyword">sql</span> <span class="string">&#x27;alter database open resetlogs&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/wps5.jpg" alt="img"></p><p>11   查询表，bkp, test 看看哪些数据被恢复 – 理解不完全恢复的概念</p><h1 id="具体问题的解决"><a class="markdownIt-Anchor" href="#具体问题的解决">#</a> 具体问题的解决</h1><h2 id="查看当前oracle-版本"><a class="markdownIt-Anchor" href="#查看当前oracle-版本">#</a> 查看当前 oracle 版本:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span><span class="keyword">from</span> v$version;</span><br></pre></td></tr></table></figure><blockquote><p>mysql 为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select version();</span><br></pre></td></tr></table></figure></blockquote><h2 id="查看回收站"><a class="markdownIt-Anchor" href="#查看回收站">#</a> 查看回收站:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> recyclebin;</span><br></pre></td></tr></table></figure><h2 id="回收站当前状态"><a class="markdownIt-Anchor" href="#回收站当前状态">#</a> 回收站当前状态:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">value</span> <span class="keyword">from</span> v$<span class="keyword">parameter</span> <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;recyclebin&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="删除table不进入recycle的方法"><a class="markdownIt-Anchor" href="#删除table不进入recycle的方法">#</a> 删除 Table 不进入 Recycle 的方法：</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> tableName purge;</span><br></pre></td></tr></table></figure><blockquote><p>❗在 sys 用户下删除的表不进入回收站；</p></blockquote><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/image-20230223151804528.png" alt="image-20230223151804528"></p><h1 id="serror"><a class="markdownIt-Anchor" href="#serror">#</a> serror</h1><h2 id="ora-01109数据库未打开未解决"><a class="markdownIt-Anchor" href="#ora-01109数据库未打开未解决">#</a> ORA-01109：数据库未打开 (未解决)</h2><p>直接执行这个语句 **<font color=orange size=6>alter database open</font>** 即可。</p><p><img src="%E8%BF%99%E4%B8%80%E7%AF%87%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0.assets/image-20230222164423197.png" alt="image-20230222164423197"></p><h2 id="ora-01918-用户-scott-不存在"><a class="markdownIt-Anchor" href="#ora-01918-用户-scott-不存在">#</a> ORA-01918: 用户 ‘SCOTT’ 不存在</h2><p>①找到安装路径下的 scott.sql 文件（路径根据自己安装的情况查找，默认为：</p><p>【安装盘 /oracle\WINDOWS.X64_193000_db_home\rdbms\admin\scott.sql】）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A:\SoftwareProgram\oracle\WINDOWS.X64_193000_db_home\rdbms\admin\scott.sql</span><br></pre></td></tr></table></figure><p>②运行</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span><span class="operator">&gt;</span><span class="variable">@A</span>:\SoftwareProgram\oracle\WINDOWS.X64_193000_db_home\rdbms\admin\scott.sql</span><br></pre></td></tr></table></figure><p>③解锁 Scott 用户</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> scott account unlock;</span><br></pre></td></tr></table></figure><p>④设置 Scott 用户密码为 tiger</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> scott identified <span class="keyword">by</span> tiger;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文章内容标签 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
